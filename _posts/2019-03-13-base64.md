---
layout: post
title:  "Base64原理"
# date:   2018-06-23 10:05:05 +0800
categories: blog
---

* 目录
{:toc}

### base64
Base64是一种基于64个可打印字符来表示二进制数据的表示方法。

由于 2^6 = 64，意味着**一个字符可以表示6个bit**。所以每6个bit为一个基本单元，对应某个可打印字符。

3个byte有24个bit，对应4个Base64单元，即每3个byte由4个打印字符来表示。最后如果byte不够，则用 = 补足。


#### 字符集

64个可打印字符为  A-Z、 a-z、 0-9、加号+、斜杠/。  等号= 用作后缀，’=’的个数 表示 补充的字节数。

26 + 26 + 1 + 1 = 64

#### 原理

转换的时候，将3字节的数据，先后放入一个24位的缓冲区中，先来的字节占高位。数据不足3字节的话，于缓冲器中剩下的比特用0补足。每次取出6比特（因为 2^6=64），按照其值选择ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/中的字符作为编码后的输出，直到全部输入数据转换完成。

原数据长度，

当最后剩余两个八位字节（2个byte）时，需要补足一个字节，在编码结果后加2个=；

当最后剩余一个八位字节（2个byte）时，需要补足二个字节，则在编码结果后加1个=。

#### 大小

3个字节对应4个 Base64单元，由4个字符表示。一个字符占一个字节，所以 实际上 3个字节成了4个字节。大小增加了 1/3 

#### 用途：

* 通常用于处理文本数据的场合，用来表示、传输、存储一些二进制的文件，包括电子邮件或XML中
    * image 通过Base64编码 以字符串 传输，调用发消息接口
* url的参数编码

### URL中应用

一种用于URL编码的改进Base64编码：

1. 末尾不填充=号
2. '+' 和 '/' 改成了 - 和 _ 

详细原因：
>
    标准的Base64并不适合直接放在URL里传输，因为URL编码器会把标准Base64中的/和+字符变为形如%XX的形式，而这些%号在存入数据库时还需要再进行转换，因为ANSI SQL中已将%号用作通配符。
    为解决此问题，可采用一种用于URL的改进Base64编码，它不在末尾填充=号，并将标准Base64中的+和/分别改成了-和_，这样就免去了在URL编解码和数据库存储时所要作的转换，避免了编码信息长度在此过程中的增加，并统一了数据库、表单等处对象标识符的格式。



### 参考

- wiki：https://zh.wikipedia.org/wiki/Base64